{% extends 'base.html' %}

{% block content %}
<h1>Product detail</h1>
<ul>
    <li>{{data.product__name}}</li>
    <li>Price: ${{data.store_price}}</li>
    <li>sku: {{data.sku}}</li>
    <li>Units: {{data.product_inventory__units}}</li>
    
</ul>
<ul>
{% for attributename in att_name %}
    {{attributename.product_attribute__name}}
        {% for attribute in att_val_name %}
            {% if  attribute.attribute_values__product_attribute__name == attributename.product_attribute__name%}
                {% if attribute.attribute_values__attribute_value in data.field_a %}
                    <li id="target-{{attribute.attribute_values__attribute_value}}" 
                    class="selected fw-bold"
                    data-attribute="{{attribute.product_attribute__name}}" 
                    value="{{attribute.attribute_values__attribute_value}}">
                        {{attribute.attribute_values__attribute_value}}
                    </li>
                {% else %}
                    <li id="target-{{attribute.attribute_values__attribute_value}}"
                    data-attribute="{{attribute.product_attribute__name}}" 
                    value="{{attribute.attribute_values__attribute_value}}">
                        {{attribute.attribute_values__attribute_value}}
                    </li>
                {% endif %}
            {% endif %}
        {% endfor %}
    <br>
{% endfor %}
</ul>

<script>
    var d = {}
    
    let textBoxes = document.querySelectorAll('[id^=target')

    let e = 0
    let f = textBoxes.length

    for (let i in textBoxes) {
        if (e < f) {
            if (textBoxes[i].classList.contains("selected")) {
                d[textBoxes[i].getAttribute('data-attribute')] = textBoxes[i].getAttribute('value')
            }
        } else {
            break
        }   
        e++
    }

    document.addEventListener('click', function(e) {
        let value = e.target.getAttribute('value')
        d[e.target.getAttribute('data-attribute')] = e.target.getAttribute('value')
        let querystring = buildUrlWithParams(d)
        let url = window.location.href.split('?')[0]
        window.location.href = url + "?" + querystring
    }, false)

    function buildUrlWithParams(datas) {
        var searchparams = []
        for (var d in datas)
            searchparams.push(d + '=' + datas[d]) //key = key.value
        return searchparams.join('&')
    }
</script>
{% endblock content %}